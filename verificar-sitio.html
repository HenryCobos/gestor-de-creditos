<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Verificador de Sitio Web - AdMob</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .input-group {
            margin: 20px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .btn {
            background: #2196F3;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .btn:hover {
            background: #1976D2;
        }
        .result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
        }
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .status {
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.pass { background: #28a745; color: white; }
        .status.fail { background: #dc3545; color: white; }
        .status.pending { background: #ffc107; color: black; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Verificador de Sitio Web para AdMob</h1>
        <p>Esta herramienta te ayudar√° a verificar que tu sitio web est√© configurado correctamente para AdMob.</p>
        
        <div class="input-group">
            <label for="siteUrl">URL de tu sitio en Netlify:</label>
            <input type="url" id="siteUrl" placeholder="https://tu-sitio.netlify.app" value="https://gestordecreditos.netlify.app">
        </div>
        
        <button class="btn" onclick="verificarSitio()">üöÄ Verificar Sitio</button>
        <button class="btn" onclick="verificarSoloAppAds()">üìÑ Verificar Solo app-ads.txt</button>
        
        <div id="resultados"></div>
        
        <div class="result warning" style="margin-top: 30px;">
            <h3>üìã Lista de Verificaci√≥n Manual</h3>
            <div class="test-item">
                <span>1. Sitio web accesible</span>
                <span class="status pending" id="status-1">PENDIENTE</span>
            </div>
            <div class="test-item">
                <span>2. app-ads.txt existe y es accesible</span>
                <span class="status pending" id="status-2">PENDIENTE</span>
            </div>
            <div class="test-item">
                <span>3. Contenido de app-ads.txt es correcto</span>
                <span class="status pending" id="status-3">PENDIENTE</span>
            </div>
            <div class="test-item">
                <span>4. Content-Type es text/plain</span>
                <span class="status pending" id="status-4">PENDIENTE</span>
            </div>
            <div class="test-item">
                <span>5. No hay redirecciones</span>
                <span class="status pending" id="status-5">PENDIENTE</span>
            </div>
            <div class="test-item">
                <span>6. HTTPS funcionando</span>
                <span class="status pending" id="status-6">PENDIENTE</span>
            </div>
        </div>
        
        <div class="result success" style="margin-top: 20px;">
            <h3>‚úÖ Contenido Esperado de app-ads.txt:</h3>
            <pre>google.com, pub-4349408589058649, DIRECT, f08c47fec0942fa0
# iOS App Bundle ID: com.gestordecreditos.app
# AdMob App ID: ca-app-pub-4349408589058649~7588427896</pre>
        </div>
    </div>

    <script>
        function mostrarResultado(mensaje, tipo) {
            const resultados = document.getElementById('resultados');
            resultados.innerHTML = `<div class="result ${tipo}">${mensaje}</div>`;
        }
        
        function actualizarStatus(id, estado) {
            const elemento = document.getElementById(`status-${id}`);
            elemento.textContent = estado === 'pass' ? 'PASS' : estado === 'fail' ? 'FAIL' : 'PENDIENTE';
            elemento.className = `status ${estado}`;
        }
        
        async function verificarSitio() {
            const siteUrl = document.getElementById('siteUrl').value;
            if (!siteUrl) {
                mostrarResultado('‚ùå Por favor ingresa la URL de tu sitio', 'error');
                return;
            }
            
            let resultados = '<h3>üîç Resultados de Verificaci√≥n:</h3>';
            let errores = 0;
            
            try {
                // 1. Verificar sitio principal
                try {
                    const response = await fetch(siteUrl);
                    if (response.ok) {
                        resultados += '<p>‚úÖ Sitio web principal accesible</p>';
                        actualizarStatus(1, 'pass');
                        actualizarStatus(6, 'pass'); // HTTPS
                    } else {
                        resultados += `<p>‚ùå Error al acceder al sitio principal: ${response.status}</p>`;
                        actualizarStatus(1, 'fail');
                        errores++;
                    }
                } catch (error) {
                    resultados += `<p>‚ùå Error al acceder al sitio principal: ${error.message}</p>`;
                    actualizarStatus(1, 'fail');
                    errores++;
                }
                
                // 2. Verificar app-ads.txt
                await verificarAppAds(siteUrl, resultados);
                
            } catch (error) {
                mostrarResultado(`‚ùå Error general: ${error.message}`, 'error');
            }
        }
        
        async function verificarAppAds(siteUrl, resultados = '') {
            const appAdsUrl = siteUrl.replace(/\/$/, '') + '/app-ads.txt';
            
            try {
                const response = await fetch(appAdsUrl);
                
                if (response.ok) {
                    resultados += '<p>‚úÖ app-ads.txt es accesible</p>';
                    actualizarStatus(2, 'pass');
                    
                    // Verificar content-type
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('text/plain')) {
                        resultados += '<p>‚úÖ Content-Type correcto (text/plain)</p>';
                        actualizarStatus(4, 'pass');
                    } else {
                        resultados += `<p>‚ö†Ô∏è Content-Type: ${contentType || 'no especificado'}</p>`;
                        actualizarStatus(4, 'fail');
                    }
                    
                    // Verificar contenido
                    const content = await response.text();
                    const expectedContent = 'google.com, pub-4349408589058649, DIRECT, f08c47fec0942fa0';
                    
                    if (content.includes(expectedContent)) {
                        resultados += '<p>‚úÖ Contenido de app-ads.txt correcto</p>';
                        actualizarStatus(3, 'pass');
                    } else {
                        resultados += '<p>‚ùå Contenido de app-ads.txt incorrecto</p>';
                        actualizarStatus(3, 'fail');
                    }
                    
                    resultados += `<p><strong>Contenido actual:</strong></p><pre>${content}</pre>`;
                    
                    // Verificar redirecciones
                    if (response.redirected) {
                        resultados += '<p>‚ö†Ô∏è Hay redirecciones detectadas</p>';
                        actualizarStatus(5, 'fail');
                    } else {
                        resultados += '<p>‚úÖ Sin redirecciones</p>';
                        actualizarStatus(5, 'pass');
                    }
                    
                } else {
                    resultados += `<p>‚ùå app-ads.txt no accesible: ${response.status}</p>`;
                    actualizarStatus(2, 'fail');
                    actualizarStatus(3, 'fail');
                }
                
            } catch (error) {
                resultados += `<p>‚ùå Error al verificar app-ads.txt: ${error.message}</p>`;
                actualizarStatus(2, 'fail');
            }
            
            mostrarResultado(resultados, errores > 0 ? 'warning' : 'success');
        }
        
        async function verificarSoloAppAds() {
            const siteUrl = document.getElementById('siteUrl').value;
            if (!siteUrl) {
                mostrarResultado('‚ùå Por favor ingresa la URL de tu sitio', 'error');
                return;
            }
            
            await verificarAppAds(siteUrl);
        }
        
        // Auto-verificar si hay URL predeterminada
        window.onload = function() {
            const url = document.getElementById('siteUrl').value;
            if (url && url !== 'https://gestordecreditos.netlify.app') {
                // Solo auto-verificar si es una URL real diferente a la de ejemplo
            }
        };
    </script>
</body>
</html>
